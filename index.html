<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secret Messenger (AES-128-ECB)</title>
    <!-- Import CryptoJS from a CDN (Works on GitHub Pages) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #222; color: #fff; padding: 20px; max-width: 600px; margin: 0 auto; }
        .card { background: #333; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.3); }
        h2 { margin-top: 0; color: #00d2ff; }
        textarea { width: 100%; height: 100px; background: #111; color: #0f0; border: 1px solid #444; padding: 10px; box-sizing: border-box; font-family: monospace; resize: vertical; }
        button { background: #00d2ff; border: none; padding: 10px 20px; color: #000; font-weight: bold; cursor: pointer; margin-top: 10px; border-radius: 4px; }
        button.secondary { background: #555; color: #fff; }
        button:hover { opacity: 0.9; }
        input[type="file"] { display: none; }
        .file-btn { display: inline-block; background: #e67e22; padding: 10px; border-radius: 4px; cursor: pointer; text-align: center; width: 100%; box-sizing: border-box; margin-bottom: 10px;}
        .status { font-size: 0.8rem; color: #aaa; margin-top: 5px; }
        .warning { color: #ff5555; font-size: 0.8rem; margin-bottom: 10px; }
    </style>
</head>
<body>

    <!-- SECTION 1: KEY MANAGEMENT -->
    <div class="card">
        <h2>1. Security Config</h2>
        <div class="warning">‚ö†Ô∏è Using AES-ECB. For fun/casual use only.</div>
        
        <p>Current Key: <span id="keyStatus" style="color: #ff5555;">NONE (Load or Generate)</span></p>

        <!-- Load Config -->
        <label class="file-btn">
            üìÇ Load 'encrypt.config'
            <input type="file" id="fileInput" accept=".json" onchange="loadConfig()">
        </label>

        <!-- Generate Config -->
        <button class="secondary" style="width:100%" onclick="generateConfig()">‚öôÔ∏è Generate New Config for Friends</button>
    </div>

    <!-- SECTION 2: ENCRYPT/DECRYPT -->
    <div class="card">
        <h2>2. Message Translator</h2>
        
        <textarea id="inputText" placeholder="Enter plain text to Encrypt... OR Paste encrypted code to Decrypt..."></textarea>
        
        <div style="display: flex; gap: 10px;">
            <button onclick="process('encrypt')" style="flex:1">üîí Encrypt</button>
            <button onclick="process('decrypt')" style="flex:1; background:#e67e22">üîì Decrypt</button>
        </div>

        <h3>Result:</h3>
        <textarea id="outputText" readonly placeholder="Result appears here..."></textarea>
        <button class="secondary" onclick="copyResult()">üìã Copy Result</button>
    </div>

    <script>
        // Global variable to hold the secret key
        let SECRET_KEY = null;

        // 1. GENERATE CONFIG (Creates a random 16-char string)
        function generateConfig() {
            // Generate 16 random bytes -> convert to hex string (32 chars) for key
            // AES-128 requires a 128-bit key.
            const randomKey = CryptoJS.lib.WordArray.random(128/8).toString();
            
            const configObj = {
                algo: "AES-128-ECB",
                key: randomKey,
                note: "Share this file securely with friends!"
            };

            // Download file logic
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(configObj));
            const downloadAnchorNode = document.createElement('a');
            downloadAnchorNode.setAttribute("href", dataStr);
            downloadAnchorNode.setAttribute("download", "encrypt.config.json");
            document.body.appendChild(downloadAnchorNode);
            downloadAnchorNode.click();
            downloadAnchorNode.remove();

            // Auto-load it for the user
            SECRET_KEY = randomKey;
            updateStatus(true);
        }

        // 2. LOAD CONFIG
        function loadConfig() {
            const file = document.getElementById('fileInput').files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const config = JSON.parse(e.target.result);
                    if(config.key) {
                        SECRET_KEY = config.key;
                        updateStatus(true);
                    } else {
                        alert("Invalid config file!");
                    }
                } catch (err) {
                    alert("Error reading file.");
                }
            };
            reader.readAsText(file);
        }

        // 3. ENCRYPTION / DECRYPTION LOGIC
        function process(mode) {
            if (!SECRET_KEY) {
                alert("Please load or generate an encrypt.config file first!");
                return;
            }

            const input = document.getElementById('inputText').value;
            const outputBox = document.getElementById('outputText');
            
            try {
                // Parse the hex key
                const keyHex = CryptoJS.enc.Hex.parse(SECRET_KEY);

                if (mode === 'encrypt') {
                    // AES-128-ECB Encryption
                    const encrypted = CryptoJS.AES.encrypt(input, keyHex, {
                        mode: CryptoJS.mode.ECB,
                        padding: CryptoJS.pad.Pkcs7
                    });
                    // Output is Base64 by default in CryptoJS
                    outputBox.value = encrypted.toString();
                } 
                else {
                    // Decryption
                    const decrypted = CryptoJS.AES.decrypt(input, keyHex, {
                        mode: CryptoJS.mode.ECB,
                        padding: CryptoJS.pad.Pkcs7
                    });
                    outputBox.value = decrypted.toString(CryptoJS.enc.Utf8);
                    
                    // If decryption fails (wrong key/garbage text), result is empty
                    if(!outputBox.value) outputBox.value = "‚ö†Ô∏è Decryption failed (Wrong Key?)";
                }
            } catch (e) {
                outputBox.value = "Error: " + e.message;
            }
        }

        function updateStatus(isLoaded) {
            const el = document.getElementById('keyStatus');
            if(isLoaded) {
                el.innerText = "ACTIVE (Ready to chat)";
                el.style.color = "#0f0";
            }
        }

        function copyResult() {
            const copyText = document.getElementById("outputText");
            copyText.select();
            document.execCommand("copy");
        }
    </script>
</body>
</html>
